<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"><title>Bundling – Lightning CSS</title><link rel="icon" href="/favicon.3aabf677.svg"><link rel="mask-icon" href="/favicon.3aabf677.svg" color="#f9bb03"><meta name="description" content="An extremely fast CSS parser, transformer, bundler, and minifier."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="/og.jpeg"><meta name="twitter:site" content="@lightningcss"><meta name="twitter:creator" content="@lightningcss"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://lightningcss.dev/bundling.html"><meta property="og:title" content="Bundling – Lightning CSS"><meta property="og:description" content="An extremely fast CSS parser, transformer, bundler, and minifier."><meta property="og:image" content="/og.jpeg"><link rel="stylesheet" href="/bundling.38e86224.css"></head><body> <header> <svg viewBox="495 168 360 654"><path class="outer" d="M594.41 805c-.71 0-1.43-.15-2.11-.47a5.015 5.015 0 0 1-2.72-5.83l67.98-253.71H517.11a5.03 5.03 0 0 1-4.44-2.69c-.86-1.65-.73-3.65.34-5.18l26.85-38.35q25.56-36.51 104.91-149.83l106.31-151.82a4.991 4.991 0 0 1 6.21-1.66 5.015 5.015 0 0 1 2.72 5.83L692.03 455h140.45c1.86 0 3.57 1.04 4.43 2.69.86 1.65.73 3.65-.34 5.18l-238.07 340a5.006 5.006 0 0 1-4.1 2.13Zm-67.69-270h137.37c1.55 0 3.02.72 3.97 1.96.95 1.23 1.27 2.84.86 4.34l-62.33 232.61 216.29-308.9H685.52c-1.55 0-3.02-.72-3.97-1.96a4.966 4.966 0 0 1-.86-4.34l62.33-232.61-90.04 128.59q-79.35 113.32-104.91 149.83L526.73 535Z"/><path class="inner" d="M594.41 805c-.71 0-1.43-.15-2.11-.47a5.015 5.015 0 0 1-2.72-5.83l67.98-253.71H517.11a5.03 5.03 0 0 1-4.44-2.69c-.86-1.65-.73-3.65.34-5.18l26.85-38.35q25.56-36.51 104.91-149.83l106.31-151.82a4.991 4.991 0 0 1 6.21-1.66 5.015 5.015 0 0 1 2.72 5.83L692.03 455h140.45c1.86 0 3.57 1.04 4.43 2.69.86 1.65.73 3.65-.34 5.18l-238.07 340a5.006 5.006 0 0 1-4.1 2.13Zm-67.69-270h137.37c1.55 0 3.02.72 3.97 1.96.95 1.23 1.27 2.84.86 4.34l-62.33 232.61 216.29-308.9H685.52c-1.55 0-3.02-.72-3.97-1.96a4.966 4.966 0 0 1-.86-4.34l62.33-232.61-90.04 128.59q-79.35 113.32-104.91 149.83L526.73 535Z"/></svg> <a href="/" class="title">Lightning CSS</a> <p><a href="/playground/index.html">Playground</a> • <a href="/docs.html">Docs</a> • <a href="https://docs.rs/lightningcss" target="_blank">Rust docs</a> • <a href="https://npmjs.com/lightningcss" target="_blank">npm</a> • <a href="https://github.com/parcel-bundler/lightningcss" target="_blank">GitHub</a></p> </header> <nav> <h3>Docs</h3> <ul> <li><a href="/docs.html">Getting started</a></li> <li><a href="/transpilation.html">Transpilation</a></li> <li><a href="/css-modules.html">CSS Modules</a></li> <li><a href="/bundling.html">Bundling</a></li> <li><a href="/minification.html">Minification</a></li> <li><a href="/transforms.html">Custom transforms</a></li> <script>document.querySelector(`nav a[href="${location.pathname}"]`).setAttribute("aria-current","page");</script> </ul> </nav> <main> <aside> <p></p><div class="table-of-contents"><h3>On this page</h3><ul><li><a href="#dependencies">Dependencies</a><ul><li><a href="#%40import">@import</a></li><li><a href="#css-modules">CSS modules</a></li></ul></li><li><a href="#conditional-imports">Conditional imports</a></li><li><a href="#cascade-layers">Cascade layers</a></li><li><a href="#bundling-order">Bundling order</a></li><li><a href="#custom-resolvers">Custom resolvers</a></li></ul></div><p></p> </aside> <h1 id="bundling" tabindex="-1">Bundling</h1> <p>Lightning CSS supports bundling dependencies referenced by CSS <code>@import</code> rules into a single output file. When calling the Lightning CSS API, use the <code>bundle</code> or <code>bundleAsync</code> function instead of <code>transform</code>. When using the CLI, enable the <code>--bundle</code> flag.</p> <p>This API requires filesystem access, so it does not accept <code>code</code> directly via the API. Instead, the <code>filename</code> option is used to read the entry file directly.</p> <pre class="language-js"><code class="language-js"><span class="keyword token">import</span> <span class="punctuation token">{</span> bundle <span class="punctuation token">}</span> <span class="keyword token">from</span> <span class="string token">'lightningcss'</span><span class="punctuation token">;</span>

<span class="keyword token">let</span> <span class="punctuation token">{</span> code<span class="punctuation token">,</span> map <span class="punctuation token">}</span> <span class="operator token">=</span> <span class="function token">bundle</span><span class="punctuation token">(</span><span class="punctuation token">{</span>
  <span class="literal-property property token">filename</span><span class="operator token">:</span> <span class="string token">'style.css'</span><span class="punctuation token">,</span>
  <span class="literal-property property token">minify</span><span class="operator token">:</span> <span class="boolean token">true</span>
<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
</code></pre> <h2 id="dependencies" tabindex="-1">Dependencies</h2> <p>CSS files can contain dependencies referenced by <code>@import</code> syntax, as well as references to classes in other files via <a href="/css-modules.html">CSS modules</a>.</p> <h3 id="%40import" tabindex="-1">@import</h3> <p>The <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@import"><code>@import</code></a> at-rule can be used to inline another CSS file into the same CSS bundle as the containing file. This means that at runtime a separate network request will not be needed to load the dependency. Referenced files should be relative to the containing CSS file.</p> <pre class="language-css"><code class="language-css"><span class="atrule token"><span class="rule token">@import</span> <span class="string token">'other.css'</span><span class="punctuation token">;</span></span>
</code></pre> <p><code>@import</code> rules must appear before all other rules in a stylesheet except <code>@charset</code> and <code>@layer</code> statement rules. Later import rules will cause an error to be emitted.</p> <h3 id="css-modules" tabindex="-1">CSS modules</h3> <p>Dependencies are also bundled when referencing another file via <a href="/css-modules.html#dependencies">CSS modules composition</a> or <a href="/css-modules.html#local-css-variables">external variables</a>. See the linked CSS modules documentation for more details.</p> <h2 id="conditional-imports" tabindex="-1">Conditional imports</h2> <p>The <code>@import</code> rule can be conditional by appending a media query or <code>supports()</code> query. Lightning CSS will preserve this behavior by wrapping the inlined rules in <code>@media</code> and <code>@supports</code> rules as needed.</p> <pre class="language-css"><code class="language-css"><span class="comment token">/* a.css */</span>
<span class="atrule token"><span class="rule token">@import</span> <span class="string token">"b.css"</span> print<span class="punctuation token">;</span></span>
<span class="atrule token"><span class="rule token">@import</span> <span class="string token">"c.css"</span> <span class="function token">supports</span><span class="punctuation token">(</span><span class="property token">display</span><span class="punctuation token">:</span> grid<span class="punctuation token">)</span><span class="punctuation token">;</span></span>

<span class="selector token">.a</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> red <span class="punctuation token">}</span>
</code></pre> <pre class="language-css"><code class="language-css"><span class="comment token">/* b.css */</span>
<span class="selector token">.b</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> green <span class="punctuation token">}</span>
</code></pre> <pre class="language-css"><code class="language-css"><span class="comment token">/* c.css */</span>
<span class="selector token">.c</span> <span class="punctuation token">{</span> <span class="property token">display</span><span class="punctuation token">:</span> grid <span class="punctuation token">}</span>
</code></pre> <p>compiles to:</p> <pre class="language-css"><code class="language-css"><span class="atrule token"><span class="rule token">@media</span> print</span> <span class="punctuation token">{</span>
  <span class="selector token">.b</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> green <span class="punctuation token">}</span>
<span class="punctuation token">}</span>

<span class="atrule token"><span class="rule token">@supports</span> <span class="punctuation token">(</span><span class="property token">display</span><span class="punctuation token">:</span> grid<span class="punctuation token">)</span></span> <span class="punctuation token">{</span>
  <span class="selector token">.c</span> <span class="punctuation token">{</span> <span class="property token">display</span><span class="punctuation token">:</span> grid <span class="punctuation token">}</span>
<span class="punctuation token">}</span>

<span class="selector token">.a</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> red <span class="punctuation token">}</span>
</code></pre> <div class="warning"> <p><strong>Note</strong>: There are currently two cases where combining conditional rules is unsupported:</p> <ol> <li>Importing the same CSS file with only a media query, and again with only a supports query. This would require duplicating all rules in the file.</li> <li>Importing a file with a negated media type (e.g. <code>not print</code>) within another file with a negated media type.</li> </ol> </div> <h2 id="cascade-layers" tabindex="-1">Cascade layers</h2> <p>Imported CSS rules can also be placed into a CSS cascade layer, allowing you to control the order they apply. Nested imports will be placed into nested layers.</p> <pre class="language-css"><code class="language-css"><span class="comment token">/* a.css */</span>
<span class="atrule token"><span class="rule token">@import</span> <span class="string token">"b.css"</span> <span class="function token">layer</span><span class="punctuation token">(</span>foo<span class="punctuation token">)</span><span class="punctuation token">;</span></span>
<span class="selector token">.a</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> red <span class="punctuation token">}</span>
</code></pre> <pre class="language-css"><code class="language-css"><span class="comment token">/* b.css */</span>
<span class="atrule token"><span class="rule token">@import</span> <span class="string token">"c.css"</span> <span class="function token">layer</span><span class="punctuation token">(</span>bar<span class="punctuation token">)</span><span class="punctuation token">;</span></span>
<span class="selector token">.b</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> green <span class="punctuation token">}</span>
</code></pre> <pre class="language-css"><code class="language-css"><span class="comment token">/* c.css */</span>
<span class="selector token">.c</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> green <span class="punctuation token">}</span>
</code></pre> <p>compiles to:</p> <pre class="language-css"><code class="language-css"><span class="atrule token"><span class="rule token">@layer</span> foo.bar</span> <span class="punctuation token">{</span>
  <span class="selector token">.c</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> green <span class="punctuation token">}</span>
<span class="punctuation token">}</span>

<span class="atrule token"><span class="rule token">@layer</span> foo</span> <span class="punctuation token">{</span>
  <span class="selector token">.b</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> green <span class="punctuation token">}</span>
<span class="punctuation token">}</span>

<span class="selector token">.a</span> <span class="punctuation token">{</span> <span class="property token">color</span><span class="punctuation token">:</span> red <span class="punctuation token">}</span>
</code></pre> <div class="warning"> <p><strong>Note</strong>: There are two unsupported layer combinations that will currently emit a compiler error:</p> <ol> <li>Importing the same CSS file with different layer names. This would require duplicating all imported rules multiple times.</li> <li>Nested anonymous layers.</li> </ol> </div> <h2 id="bundling-order" tabindex="-1">Bundling order</h2> <p>When <code>@import</code> rules are processed in browsers, if the same file appears more than once, the <em>last</em> instance applies. This is the opposite from behavior in other languages like JavaScript. Lightning CSS follows this behavior when bundling so that the output behaves the same as if it were not bundled.</p> <pre class="language-css"><code class="language-css"><span class="comment token">/* index.css */</span>
<span class="atrule token"><span class="rule token">@import</span> <span class="string token">"a.css"</span><span class="punctuation token">;</span></span>
<span class="atrule token"><span class="rule token">@import</span> <span class="string token">"b.css"</span><span class="punctuation token">;</span></span>
<span class="atrule token"><span class="rule token">@import</span> <span class="string token">"a.css"</span><span class="punctuation token">;</span></span>
</code></pre> <pre class="language-css"><code class="language-css"><span class="comment token">/* a.css */</span>
<span class="selector token">body</span> <span class="punctuation token">{</span> <span class="property token">background</span><span class="punctuation token">:</span> green <span class="punctuation token">}</span>
</code></pre> <pre class="language-css"><code class="language-css"><span class="comment token">/* b.css */</span>
<span class="selector token">body</span> <span class="punctuation token">{</span> <span class="property token">background</span><span class="punctuation token">:</span> red <span class="punctuation token">}</span>
</code></pre> <p>compiles to:</p> <pre class="language-css"><code class="language-css"><span class="selector token">body</span> <span class="punctuation token">{</span> <span class="property token">background</span><span class="punctuation token">:</span> green <span class="punctuation token">}</span>
</code></pre> <h2 id="custom-resolvers" tabindex="-1">Custom resolvers</h2> <p>The <code>bundleAsync</code> API is an asynchronous version of <code>bundle</code>, which also accepts a custom <code>resolver</code> object. This allows you to provide custom JavaScript functions for resolving <code>@import</code> specifiers to file paths, and reading files from the file system (or another source). The <code>read</code> and <code>resolve</code> functions are both optional, and may either return a string synchronously, or a Promise for asynchronous resolution.</p> <pre class="language-js"><code class="language-js"><span class="keyword token">import</span> <span class="punctuation token">{</span> bundleAsync <span class="punctuation token">}</span> <span class="keyword token">from</span> <span class="string token">'lightningcss'</span><span class="punctuation token">;</span>

<span class="keyword token">let</span> <span class="punctuation token">{</span> code<span class="punctuation token">,</span> map <span class="punctuation token">}</span> <span class="operator token">=</span> <span class="keyword token">await</span> <span class="function token">bundleAsync</span><span class="punctuation token">(</span><span class="punctuation token">{</span>
  <span class="literal-property property token">filename</span><span class="operator token">:</span> <span class="string token">'style.css'</span><span class="punctuation token">,</span>
  <span class="literal-property property token">minify</span><span class="operator token">:</span> <span class="boolean token">true</span><span class="punctuation token">,</span>
  <span class="literal-property property token">resolver</span><span class="operator token">:</span> <span class="punctuation token">{</span>
    <span class="function token">read</span><span class="punctuation token">(</span><span class="parameter token">filePath</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      <span class="keyword token">return</span> fs<span class="punctuation token">.</span><span class="function token">readFileSync</span><span class="punctuation token">(</span>filePath<span class="punctuation token">,</span> <span class="string token">'utf8'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span><span class="punctuation token">,</span>
    <span class="function token">resolve</span><span class="punctuation token">(</span><span class="parameter token">specifier<span class="punctuation token">,</span> <span class="keyword token">from</span></span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      <span class="keyword token">return</span> path<span class="punctuation token">.</span><span class="function token">resolve</span><span class="punctuation token">(</span>path<span class="punctuation token">.</span><span class="function token">dirname</span><span class="punctuation token">(</span>from<span class="punctuation token">)</span><span class="punctuation token">,</span> specifier<span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>
  <span class="punctuation token">}</span>
<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
</code></pre> <p>Note that using a custom resolver can slow down bundling significantly, especially when reading files asynchronously. Use <code>readFileSync</code> rather than <code>readFile</code> if possible for better performance, or omit either of the methods if you don't need to override the default behavior.</p> </main> <footer> Copyright © 2022 Devon Govett and Parcel Contributors. </footer> <script async src="/bundling.824fc050.js"></script> </body></html>